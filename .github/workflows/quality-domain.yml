# yaml-language-server: $schema=http://json-schema.org/draft-07/schema
name: Domain Quality
on:
  pull_request:
  merge_group:

jobs:
  install:
    name: Install All
    runs-on: ubuntu-latest
    outputs:
      artifact-id: ${{ steps.artifact-upload-step.outputs.artifact-id }}
    steps:
      - name: 🛑 Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.9.1
      - name: 🎟️ Checkout repository
        uses: actions/checkout@v3
      - name: ⬇️ Install All
        uses: ./.github/workflows/compose/install-all
        env:
          # Required for .env creation on web_app
          GOOGLE_API_KEY: ${{ env.GOOGLE_API_KEY }}

      - uses: actions/upload-artifact@v4
        id: artifact-upload-step
        with:
          name: windy-civi-quality-build
          path: /
          retention-days: 1

  domain-quality:
    name: 🔬 Domain Quality Checks
    needs: [install]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: ${{needs.install.outputs.artifact-id}}
      - name: 🔬 Quality
        working-directory: domain
        run: npm run quality

      - name: 🧪 Tests
        working-directory: domain
        run: npm run test
